(this["webpackJsonpci-client"]=this["webpackJsonpci-client"]||[]).push([[0],{49:function(e,t,a){e.exports=a(89)},54:function(e,t,a){},76:function(e,t,a){},77:function(e,t,a){},78:function(e,t,a){},79:function(e,t,a){},80:function(e,t,a){},81:function(e,t,a){},83:function(e,t,a){},84:function(e,t,a){},85:function(e,t,a){},86:function(e,t,a){},87:function(e,t,a){},88:function(e,t,a){},89:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(24),i=a.n(r),o=(a(54),a(26)),l=a(17),s=a(13),u=a(19),m=a(44),d=a(3),p=a(45),h=a.n(p).a.create({baseURL:"http://localhost:3000/api",timeout:5e3}),_=function(){return h.get("/settings").then((function(e){return e})).catch((function(e){return console.log(e)}))},g=function(e){return h.get("/builds",{params:{limit:e}}).then((function(e){return e})).catch((function(e){return console.log(e)}))},f=function(e){return h.get("/builds/".concat(e)).then((function(e){return e})).catch((function(e){return console.log(e)}))},E=function(e){return h.post("/builds/".concat(e.commitHash),{commitMessage:e.commitMessage,branchName:e.branchName,authorName:e.authorName}).then((function(e){return e})).catch((function(e){return e}))},b=function(e){return h.get("/builds/".concat(e,"/logs")).then((function(e){return e})).catch((function(e){return console.log(e)}))},N=function(e){return h.post("/settings",{repoName:e.repoName,buildCommand:e.buildCommand,mainBranch:e.mainBranch,period:Number(e.period)}).then((function(e){return e})).catch((function(e){return console.log(e)}))},v={repoName:"",buildCommand:"npm ci && npm run build",mainBranch:"master",period:"",isLoad:!1,isCloning:!1,cloningWithError:!1};var y=function(e){return{type:"LOAD",payload:e}},O=function(e){return{type:"CLONING",payload:e}},C=function(e){return{type:"ERROR_CLONING",payload:e}},k=function(e){return function(t){t(y(!0)),_().then((function(a){200===a.status?(e.push("/history"),t(y(!1)),t({type:"GET_CONFIG",payload:a.data})):(e.push("/"),t(y(!1)))})).catch((function(e){return console.log(e)}))}},L=a(48),j={isLoading:!1,buildList:[],repoName:"",runNewBuild:!1,errorPostReq:!1};var I=function(e){return{type:"LOAD_TOGGLE",payload:e}},T=function(e){return{type:"GET_REPONAME",payload:e}},B=function(e){return{type:"RUN_NEW_BUILD",payload:e}},R=function(e){return{type:"ERROR_POST_REQ",payload:e}},G={isLoading:!1,repoName:"",buildInfo:{},rebuildInfo:{},logs:""};var S=function(e){return{type:"LOAD_TOGGLE",payload:e}},w=function(e){return{type:"GET_REPONAME",payload:e}},x=function(e){return{type:"GET_LOGS",payload:e}},D=Object(u.c)({settings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_CONFIG":return Object(d.a)({},e,{},t.payload);case"LOAD":return Object(d.a)({},e,{isLoad:t.payload});case"CLONING":return Object(d.a)({},e,{isCloning:t.payload});case"ERROR_CLONING":return Object(d.a)({},e,{cloningWithError:t.payload});default:return e}},history:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_BUILD_LIST":return Object(d.a)({},e,{buildList:Object(L.a)(t.payload)});case"LOAD_TOGGLE":return Object(d.a)({},e,{isLoading:t.payload});case"GET_REPONAME":return Object(d.a)({},e,{repoName:t.payload});case"RUN_NEW_BUILD":return Object(d.a)({},e,{runNewBuild:t.payload});case"ERROR_POST_REQ":return Object(d.a)({},e,{errorPostReq:t.payload});default:return e}},details:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_BUILD_INFO":return Object(d.a)({},e,{buildInfo:Object(d.a)({},t.payload)});case"LOAD_TOGGLE":return Object(d.a)({},e,{isLoading:t.payload});case"GET_REPONAME":return Object(d.a)({},e,{repoName:t.payload});case"GET_REBUILD_INFO":return Object(d.a)({},e,{rebuildInfo:Object(d.a)({},t.payload)});case"GET_LOGS":return Object(d.a)({},e,{logs:t.payload});default:return e}}}),M=[m.a],P=Object(u.d)(D,u.a.apply(void 0,M)),F=(a(76),a(77),a(6)),H=a.n(F);a(78),a(79);function U(e){var t=e.src,a=e.text,n=e.textWithIcon,r=e.header,i=e.accent,o=e.settings,l=e.history,s=e.disabled,u=e.onClick,m=H()({button__header:r,button_accent:i,button__settings:o,header__button_history:l},"button");return c.a.createElement("button",{onClick:u,className:m,disabled:s},t&&c.a.createElement("img",{className:"button__icon",src:t,alt:"gear",disabled:s}),a||l?a:c.a.createElement("span",{className:"button__text",disabled:s},n))}function W(e){var t=e.settings,a=e.button,n=e.history,r=e.title,i=e.details,o=e.onClick,l=e.onClick2,s=e.redirectHistory,u=H()({header_settings:t,header__content:!t,"header__history-indent":n},"header","content"),m=H()("header__title",{header__title_history:n,header_details:i});return c.a.createElement("header",{className:u},c.a.createElement("h1",{className:m,onClick:s},r),n?c.a.createElement("div",{className:"header__button-wrapper"},i?c.a.createElement(U,{src:"/images/rebuild.svg",textWithIcon:"Rebuild",header:!0,onClick:o}):c.a.createElement(U,{onClick:o,src:"/images/play.svg",textWithIcon:"Run build",header:!0}),c.a.createElement(U,{onClick:l,src:"/images/gear.svg",header:!0,history:!0})):a&&c.a.createElement(U,{onClick:o,src:"/images/gear.svg",textWithIcon:"Settings",header:!0}))}a(80);function q(){return c.a.createElement("footer",{className:"footer"},c.a.createElement("div",{className:"content footer__content"},c.a.createElement("ul",{className:"footer__link-list"},c.a.createElement("li",{className:"footer__link"},"Support"),c.a.createElement("li",{className:"footer__link"},"Learning")),c.a.createElement("p",{className:"footer__copyright"},"\xa9 2020 Andrey Pogorelov")))}a(81);function A(){return c.a.createElement("img",{className:"loader",src:"/images/loader.svg",alt:"loader"})}var Q=Object(l.f)(Object(s.b)((function(e){return{settings:e.settings}}),{getConfigThunk:k})((function(e){var t=e.getConfigThunk,a=e.history,r=e.settings;Object(n.useEffect)((function(){return t(a)}),[t,a]);var i=function(){a.push("/settings")};return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"start"},c.a.createElement(W,{button:!0,title:"School CI server",onClick:i}),r.isLoad?c.a.createElement(A,null):c.a.createElement("div",{className:"settings-info content"},c.a.createElement("img",{className:"settings-info__img",src:"images/settingslogo.svg",alt:"key and screw"}),c.a.createElement("p",{className:"settings-info__text"},"Configure repository connection and synchronization settings"),c.a.createElement(U,{text:"Open settings",accent:!0,onClick:i}))),c.a.createElement(q,null))}))),z=a(16),J=a(21),K=a(47),V=a.n(K);a(83),a(84);function X(e){var t=e.labelText,a=e.name,n=e.require,r=e.value,i=e.onChange,o=e.placeholder,l=e.onClick,s=H()("settings__paragraph",{settings__require:n});return c.a.createElement(c.a.Fragment,null,c.a.createElement("label",{className:s,htmlFor:a},t),c.a.createElement("div",{className:"input"},c.a.createElement("input",{className:"input__field",id:a,type:"text",placeholder:o,value:r,onChange:i,name:a,required:n}),c.a.createElement("button",{className:"input__field-cancel",name:a,onClick:l})))}var Y={repoName:"",buildCommand:"npm ci && npm run build",mainBranch:"master",period:""};var Z=Object(l.f)(Object(s.b)((function(e){var t=e.settings;return{isCloning:t.isCloning,cloningWithError:t.cloningWithError}}),{postSaveSettings:function(e,t){return function(a){a(O(!0)),N(e).then((function(e){console.log(e),200!==e.status?(a(C(!0)),a(O(!1))):(a(O(!1)),t.push("/history"))})).catch((function(e){a(O(!1)),a(C(!0)),console.log(e)}))}}})((function(e){var t=e.history,a=e.postSaveSettings,r=e.isCloning,i=e.cloningWithError,o=Object(n.useState)(Y),l=Object(J.a)(o,2),s=l[0],u=l[1],m=function(e){var t=e.target,a=t.name,n=t.value;console.log(s.period),u((function(e){return Object(d.a)({},e,Object(z.a)({},a,n))}))},p=function(e){e.preventDefault();var t=e.target.name;u((function(e){return Object(d.a)({},e,Object(z.a)({},t,""))}))};return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"settings"},c.a.createElement(W,{settings:!0,title:"School CI server",text:"test"}),c.a.createElement("div",{className:"content"},c.a.createElement("h2",{className:"settings__title"},"Settings"),c.a.createElement("p",{className:"settings__subtitle"},"Configure repository connection and synchronization settings."),c.a.createElement("form",{className:"settings__form"},c.a.createElement(X,{labelText:"GitHub repository",name:"repoName",placeholder:"user-name/repo-name",require:!0,onChange:m,value:s.repoName,onClick:p}),c.a.createElement(X,{labelText:"Build command",name:"buildCommand",placeholder:"build command",require:!0,onChange:m,value:s.buildCommand,onClick:p}),c.a.createElement(X,{labelText:"Main branch",name:"mainBranch",placeholder:"branch",onChange:m,value:s.mainBranch,onClick:p}),i&&c.a.createElement("span",{className:"settings__fail"},"fail clone repository"),c.a.createElement("div",{className:"settings__time-wrapper"},c.a.createElement("p",{className:"settings__paragraph"},"Synchronize every"),c.a.createElement(V.a,{className:"input__field input__field_time",name:"period",onChange:m,value:s.period,mask:[/\d/,/\d/],guide:!1}),c.a.createElement("p",{className:"settings__paragraph"},"minutes")),c.a.createElement("div",{className:"settings__button-wrapper"},c.a.createElement(U,{accent:!0,text:"Save",settings:!0,onClick:function(e){e.preventDefault(),/(.)\/(.)/g.test(s.repoName)&&s.buildCommand.length>5&&s.period.length>0&&a(s,t)},disabled:r}),c.a.createElement(U,{text:"Cancel",disabled:r,onClick:function(e){e.preventDefault(),t.goBack()}}))))),c.a.createElement(q,null))}))),$=(a(85),a(92)),ee=a(93);a(86);function te(e){var t=e.details,a=e.id,n=e.buildNumber,r=e.commitMessage,i=e.commitHash,o=void 0===i?"":i,l=e.branchName,s=e.authorName,u=e.status,m=e.start,d=e.duration,p=e.onClick,h=H()("card__information",{details__card:t}),_=H()("card__atributes",{details__atributes:t}),g=H()("card__date",{details__date:t}),f=H()("card__day-container",{"details__day-container":t}),E=H()("card__day",{details__day:t}),b=H()("card__number-ticket",{"card__number-ticket_good":"Success"===u,"card__number-ticket_queue":"Waiting"===u||"InProgress"===u,"card__number-ticket_reject":"Fail"===u||"Canceled"===u}),N=H()("card__icon-pr",{"card__icon-pr_good":"Success"===u,"card__icon-pr_queue":"Waiting"===u||"InProgress"===u,"card__icon-pr_reject":"Fail"===u||"Canceled"===u}),v=o.slice(0,6);return c.a.createElement("div",{"data-hash":a,onClick:p,className:"card"},c.a.createElement("div",{className:"card__discription"},c.a.createElement("div",{className:N}),c.a.createElement("div",{className:h},c.a.createElement("div",{className:"card__content-wrapper"},c.a.createElement("div",{className:"card__title-wrapper"},c.a.createElement("p",{className:b},"#".concat(n)),c.a.createElement("h3",{className:"card__title"},r)),c.a.createElement("div",{className:_},c.a.createElement("div",{className:"card__git-info"},c.a.createElement("img",{className:"card__icon-atribute",src:"/images/commit.svg",alt:"commit icon"}),c.a.createElement("p",{className:"card__branch"},l),c.a.createElement("p",{className:"card__commit"},v)),c.a.createElement("div",{className:"card__author-container"},c.a.createElement("img",{className:"card__icon-atribute",src:"/images/user.svg",alt:"use icon"}),c.a.createElement("p",{className:"card__author"},s)))),c.a.createElement("div",{className:g},c.a.createElement("div",{className:f},c.a.createElement("img",{className:"card__icon-atribute",src:"/images/calendar.svg",alt:"calendar icon"}),c.a.createElement("p",{className:E},m&&Object($.a)(new Date(m),"d MMM HH:mm",{locale:ee.a}).replace(".",","))),c.a.createElement("div",{className:"card__time-container"},c.a.createElement("img",{className:"card__icon-atribute",src:"/images/time.svg",alt:"time icon"}),c.a.createElement("p",{className:"card__time"},d&&"".concat(d/60^0," \u0447 ").concat(d%60," \u043c\u0438\u043d")))))))}a(87);function ae(e){var t=e.onChange,a=e.name,n=e.value,r=e.onClick,i=e.onClickRunBuild,o=e.closePopUp,l=e.disabled,s=e.found;return c.a.createElement("div",{className:"popup"},c.a.createElement("div",{className:"popup__wrapper"},c.a.createElement("form",{className:"popup__form"},c.a.createElement("h3",{className:"popup__title"},"New build"),c.a.createElement("p",{className:"popup__description"},"Enter the commit hash which you want to build."),c.a.createElement(X,{placeholder:"Commit hash",onClick:r,onChange:t,name:a,value:n}),c.a.createElement("div",{className:"popup__button-wrapper"},c.a.createElement(U,{accent:!0,text:"Run build",settings:!0,onClick:i,disabled:l}),c.a.createElement(U,{text:"Cancel",onClick:o}),s&&c.a.createElement("span",{className:"popup__err"},"Commit not found")))))}var ne=Object(s.b)((function(e){var t=e.history;return{isLoading:t.isLoading,buildList:t.buildList,repoName:t.repoName,runNewBuild:t.runNewBuild,allBuildList:t.allBuildList,errorPostReq:t.errorPostReq}}),{getBuildListThunk:function(e){return function(t){t(I(!0)),g(e).then((function(e){t(function(e){return{type:"GET_BUILD_LIST",payload:e}}(e.data)),t(I(!1))})).catch((function(e){return console.log(e)})),_().then((function(e){200===e.status?t(T(e.data.repoName)):t(T("No settings in the config"))})).catch((function(e){return console.log(e)}))}},postNewBuildQueue:function(e,t){return function(a){a(B(!0)),E(e).then((function(e){e.data.id?(t.push("/build/".concat(e.data.id)),a(B(!1))):(a(R(!0)),a(B(!1)))})).catch((function(e){a(R(!0)),a(B(!1)),console.log(e)}))}},getConfigThunk:k})((function(e){var t=e.getBuildListThunk,a=e.postNewBuildQueue,r=e.isLoading,i=e.buildList,o=e.repoName,l=e.history,s=e.runNewBuild,u=e.errorPostReq,m=e.getConfigThunk,p=Object(n.useState)(!1),h=Object(J.a)(p,2),_=h[0],g=h[1],f=Object(n.useState)({limit:10}),E=Object(J.a)(f,2),b=E[0],N=E[1],v=Object(n.useState)({hash:""}),y=Object(J.a)(v,2),O=y[0],C=y[1];Object(n.useEffect)((function(){m(l)}),[m,l]),Object(n.useEffect)((function(){t(b.limit)}),[t,b.limit]);var k=function(e){var t=e.currentTarget.dataset;l.push("build/".concat(t.hash))},L=i.map((function(e){var t=e.id,a=e.buildNumber,n=e.commitMessage,r=e.commitHash,i=e.branchName,o=e.authorName,l=e.status,s=e.start,u=e.duration;return c.a.createElement(te,{key:t,id:t,buildNumber:a,commitMessage:n,commitHash:r,branchName:i,authorName:o,status:l,start:s,duration:u,onClick:k})}));return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"history"},c.a.createElement(W,{button:!0,history:!0,title:o,onClick:function(){g(!0)},onClick2:function(){l.push("/settings")}}),r?c.a.createElement(A,null):c.a.createElement("div",{className:"content"},c.a.createElement("div",{className:"history__list"},L),c.a.createElement("button",{className:"button history__button",onClick:function(){N((function(e){return Object(d.a)({},e,{limit:e.limit+5})}))}},"Show more")),_?c.a.createElement(ae,{found:u,onChange:function(e){var t=e.currentTarget,a=t.value,n=t.name;C((function(e){return Object(d.a)({},e,Object(z.a)({},n,a))}))},onClick:function(e){var t=e.currentTarget.name;e.preventDefault(),C(Object(z.a)({},t,""))},name:"hash",value:O.hash,onClickRunBuild:function(e){e.preventDefault(),a({commitHash:O.hash},l)},closePopUp:function(){g(!1),C({hash:""})},disabled:s}):null),c.a.createElement(q,null))}));a(88);var ce=Object(s.b)((function(e){var t=e.details;return{isLoading:t.isLoading,repoName:t.repoName,buildInfo:t.buildInfo,logs:t.logs}}),{getDetailsBuild:function(e,t){return function(a){a(S(!0)),f(e).then((function(e){if(a(function(e){return{type:"GET_BUILD_INFO",payload:e}}(e.data)),"Success"===e.data.status)return b(e.data.id).then((function(e){a(x(e.data)),a(S(!1))})).catch((function(e){return console.log(e)}));a(x("")),a(S(!1))})).catch((function(e){a(S(!1)),console.log(e)})),_().then((function(e){200===e.status?a(w(e.data.repoName)):(t.push("/history"),a(w("No settings in the config")))})).catch((function(e){return console.log(e)}))}},postBuildInQueue:function(e,t){return function(a){a(S(!0)),E(e).then((function(e){console.log(e),a(function(e){return{type:"GET_REBUILD_INFO",payload:e}}(e.data)),t.push("".concat(e.data.id)),a(S(!1))})).catch((function(e){console.log(e),a(S(!1))}))}}})((function(e){var t=e.match,a=e.history,r=e.getDetailsBuild,i=e.postBuildInQueue,o=e.buildInfo,l=e.repoName,s=e.isLoading,u=e.logs;Object(n.useEffect)((function(){r(t.params.id,a)}),[r,t.params.id,a]);var m=o.id,d=o.buildNumber,p=void 0===d?0:d,h=o.commitMessage,_=void 0===h?"build not found":h,g=o.commitHash,f=o.branchName,E=o.authorName,b=o.status,N=o.start,v=o.duration;return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"details"},c.a.createElement(W,{button:!0,history:!0,details:!0,title:l,onClick:function(){i({commitHash:g},a)},onClick2:function(){a.push("/settings")},redirectHistory:function(){a.push("/history")}}),s?c.a.createElement(A,null):c.a.createElement("div",{className:"content"},c.a.createElement(te,{details:!0,id:m,buildNumber:p,commitMessage:_,commitHash:g,branchName:f,authorName:E,status:b,start:N,duration:v}),u&&c.a.createElement("div",{className:"details__log"},c.a.createElement("pre",null,u)))),c.a.createElement(q,null))}));var re=function(){return c.a.createElement(o.a,null,c.a.createElement(s.a,{store:P},c.a.createElement("div",{className:"App"},c.a.createElement(l.c,null,c.a.createElement(l.a,{path:"/",exact:!0,component:Q}),c.a.createElement(l.a,{path:"/settings",exact:!0,component:Z}),c.a.createElement(l.a,{path:"/history",exact:!0,component:ne}),c.a.createElement(l.a,{path:"/build/:id",component:ce})))))};i.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(re,null)),document.getElementById("root"))}},[[49,1,2]]]);
//# sourceMappingURL=main.bf55abd5.chunk.js.map