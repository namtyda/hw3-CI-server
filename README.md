## install

Нода версии v13.10.1

```
npm i
```
Создаем .env, и запускаем server.js

cd ci-client && npm i && npm start
#### .env

Создать в корне .env, в него записать 
```
APIKEY = ваш токен. 
PORT = указать порт.
```
#### Сервер 
Чтобы начать получать что-то из хранилища, обязательно нужно сохранить настройки POST запросом сюда
 ```
localhost:3000/api/settings
```
POST запросом на ручку  /api/settings - идет клонирование репы в clonesRepo, и устанавливаются вочеры за изменениями. 


GET запрос на ручку /api/builds/:buildId/logs кэшируется в файловую систему. В корне создается папка logs, в нее записываются кэши в формате buildID.cache.

Чтобы получать логи, нужно дергать билды из листа сначало ручкой /build/start

Потом /build/finish, я это не эмулировал. Поэтому нужно дергать руками из свагера, или консольки.

Остальные ручки тоже работают, они просто проксируют запросы.
 
 Работу можно показывать на разборе.

### Тесты
### Серверные
Юнит тестами на сервере проверяю правильную передачу аргументов в spawn, мокаю axios проверяю запросы на ручки, и функции кэша через мок стрима.
Интеграционнные тесты на сервере, проверяют клонирование репы, получение коммитов, добавление в очередь, удаление директорий.

Для запуска модульных тестов на сервере, установить все зависимости. Обязательно создать .evn 

Запустить командой 
```
npm run test
```
Для запуска интеграционных тестов
```
npm run test:int
```

#### На клиенте
Юнит тесты на клиенте написаны для компонентов, редьюсеров.
Интеграционные проверяют основные сценарии юзера, сохранение настроек, новый билд, ребилд, переход на страницу детальной информации, переходы межды историей и настройками.

Для запуска модульных тестов на клиенте, выполнить все мероприятия по установки зависимостей которые выше, и которые для клиента [here](ci-client/README.md)
```
cd ci-client
```

```
npm run test
```


Для запуска интеграционных тестов, установить все зависимости.
Запустить сервер 
```
node server.js
```
```
cd ci-client
```
В отдельной вкладе запустить selenium
```
selenium-standalone start 
```
Установить кастомные команды
```
cd test/hermione-custom-commands && sudo npm link && cd ../../ && sudo npm link hermione-custom-commands
```
Запустить клиент, в отдельной вкладе терминала
```
npm run start
```
Запустить gui , и в gui запустить тесты.

```
npm run hermione
```

